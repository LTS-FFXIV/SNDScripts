-- Local value to track how many times "/send Insert" has been executed
local castCount = 0

while true do
    -- Check if player is in Emanation Extreme
    if IsInZone(720) then
        -- Check for being in combat
        if GetCharacterCondition(26) then
            -- Retrieve the action ID of the current target's cast
            local actionId = GetTargetActionID()

            -- Check if the action ID matches Divine Denial, Divine Desire, or Divine Doubt
            if actionId == 8521 or actionId == 8522 or actionId == 8523 then
                -- Check if player does not have Vril status
                if not HasStatus("Vril") then
                    -- Player does not have Vril status, execute command
                    yield("/send Insert")

                    -- Increment the cast count
                    castCount = castCount + 1

                    -- Echo the number of casts
                    yield("/echo Vril Casts: " .. castCount)
                end
            end

            -- Wait for a period to avoid rapid execution
            yield("/wait 4")
        else
            -- If not in combat, wait before next check
            yield("/echo NotInCombat")
            yield("/wait 2")
        end
    else
        -- If not in the specified zone, wait before checking again
        yield("/echo NotInEmanationExtreme")
        yield("/wait 2")
    end
end
